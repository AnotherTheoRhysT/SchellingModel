<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <script src="../dist/cellauto.js"></script>

    <style>
        body {
            margin: 0;
            text-align: center;
        }
    </style>

    <script>

        window.onload = function() {

            var world = new CAWorld({
                width: 100,
                height: 66,
                cellSize: 6
            });

            world.registerCellType('living', {
                getColor: function() {
                    return this.alive ? '68, 36, 52, 1' : '255, 255, 255, 1';
                },
                process: function(neighbors) {
                    var surrounding = 0;
                    for (var i=0; i<neighbors.length; i++) {
                        if (neighbors[i] !== null && neighbors[i].wasAlive) {
                            surrounding++;
                        }
                    }
                    this.alive = surrounding === 3 || surrounding === 2 && this.alive;
                },
                reset: function() {
                    this.wasAlive = this.alive;
                }
            }, function() {
                this.alive = Math.random() > 0.5;
            });

            world.initialize([
                { name: 'living', distribution: 100 }
            ]);

            var myCanvas = document.getElementById('myCanvas');
            myCanvas.width = world.cellSize * world.width;
            myCanvas.height = world.cellSize * world.height;
            var ctx = myCanvas.getContext('2d');

            var frames = 0;
            function loop() {

                // limit speed of simulation
                if(frames % 3 === 0) {
                    world.step();
                    drawGrid(ctx, world);
                }

                requestAnimationFrame(loop);

                frames++;
            };

            requestAnimationFrame(loop);
        };

        function drawGrid(ctx, world) {
            ctx.clearRect(0, 0, world.width*world.cellSize, world.height*world.cellSize);

            for (var y=0; y<world.height; y++) {
                for (var x=0; x<world.width; x++) {
                    ctx.fillStyle = 'rgba(' + world.grid[y][x].getColor() + ')';
                    ctx.fillRect(x*world.cellSize, y*world.cellSize, world.cellSize, world.cellSize);
                }
            }
        }


    </script>

</head>

<body>
    <canvas id="myCanvas" />
</body>
</html>